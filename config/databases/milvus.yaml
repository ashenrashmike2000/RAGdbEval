# =============================================================================
# Milvus Configuration
# =============================================================================
# Distributed vector database for scalable similarity search
# Documentation: https://milvus.io/docs
# =============================================================================

database:
  name: "milvus"
  display_name: "Milvus"
  version: "2.3.0"
  type: "database"
  language: "Go/C++"
  license: "Apache-2.0"

# -----------------------------------------------------------------------------
# Connection Settings
# -----------------------------------------------------------------------------
connection:
  host: "localhost"
  port: 19530
  user: ""
  password: ""
  timeout: 60
  secure: false

  # Docker configuration for isolated testing
  docker:
    enabled: true
    compose_file: "docker/milvus-standalone.yaml"
    memory_limit: "16g"
    cpu_limit: 8

# -----------------------------------------------------------------------------
# Collection Settings
# -----------------------------------------------------------------------------
collection:
  name_prefix: "benchmark"
  shards_num: 1
  consistency_level: "Strong"  # Strong, Bounded, Session, Eventually

  # Auto-flush settings
  auto_flush: true
  flush_interval_ms: 1000

# -----------------------------------------------------------------------------
# Index Configurations to Test
# -----------------------------------------------------------------------------
index_configurations:
  # Flat index (exact search)
  - name: "FLAT"
    type: "FLAT"
    description: "Brute-force exact search"
    params: {}
    search_params: {}

  # IVF_FLAT
  - name: "IVF_FLAT_1024"
    type: "IVF_FLAT"
    description: "IVF with 1024 clusters"
    params:
      nlist: 1024
    search_params:
      nprobe: [1, 4, 8, 16, 32, 64, 128]

  - name: "IVF_FLAT_4096"
    type: "IVF_FLAT"
    description: "IVF with 4096 clusters"
    params:
      nlist: 4096
    search_params:
      nprobe: [1, 4, 8, 16, 32, 64, 128, 256]

  # IVF_SQ8
  - name: "IVF_SQ8_1024"
    type: "IVF_SQ8"
    description: "IVF with 8-bit scalar quantization"
    params:
      nlist: 1024
    search_params:
      nprobe: [1, 4, 8, 16, 32, 64]

  - name: "IVF_SQ8_4096"
    type: "IVF_SQ8"
    description: "IVF_SQ8 with 4096 clusters"
    params:
      nlist: 4096
    search_params:
      nprobe: [1, 4, 8, 16, 32, 64, 128]

  # IVF_PQ
  - name: "IVF_PQ_1024_m16"
    type: "IVF_PQ"
    description: "IVF with product quantization (16 sub-vectors)"
    params:
      nlist: 1024
      m: 16
      nbits: 8
    search_params:
      nprobe: [1, 4, 8, 16, 32, 64]

  - name: "IVF_PQ_4096_m32"
    type: "IVF_PQ"
    description: "IVF_PQ with 4096 clusters, 32 sub-vectors"
    params:
      nlist: 4096
      m: 32
      nbits: 8
    search_params:
      nprobe: [1, 4, 8, 16, 32, 64, 128]

  # HNSW
  - name: "HNSW_M16"
    type: "HNSW"
    description: "HNSW with M=16"
    params:
      M: 16
      efConstruction: 200
    search_params:
      ef: [50, 100, 200, 300, 500]

  - name: "HNSW_M32"
    type: "HNSW"
    description: "HNSW with M=32"
    params:
      M: 32
      efConstruction: 200
    search_params:
      ef: [64, 128, 256, 512]

  - name: "HNSW_M48"
    type: "HNSW"
    description: "HNSW with M=48 (high accuracy)"
    params:
      M: 48
      efConstruction: 400
    search_params:
      ef: [100, 200, 400, 600]

  # DISKANN (disk-based ANN)
  - name: "DISKANN"
    type: "DISKANN"
    description: "Disk-based ANN index"
    params:
      search_list_size: 100
      max_degree: 56
      build_list_size: 100
    search_params:
      search_list: [50, 100, 200]

  # GPU indices (if available)
  - name: "GPU_IVF_FLAT"
    type: "GPU_IVF_FLAT"
    description: "GPU-accelerated IVF"
    params:
      nlist: 1024
    search_params:
      nprobe: [1, 4, 8, 16, 32, 64]
    requires_gpu: true

  - name: "GPU_IVF_PQ"
    type: "GPU_IVF_PQ"
    description: "GPU-accelerated IVF_PQ"
    params:
      nlist: 1024
      m: 16
      nbits: 8
    search_params:
      nprobe: [1, 4, 8, 16, 32]
    requires_gpu: true

# -----------------------------------------------------------------------------
# Distance Metrics Support
# -----------------------------------------------------------------------------
distance_metrics:
  l2:
    supported: true
    milvus_name: "L2"
  cosine:
    supported: true
    milvus_name: "COSINE"
  ip:
    supported: true
    milvus_name: "IP"

# -----------------------------------------------------------------------------
# Schema Configuration
# -----------------------------------------------------------------------------
schema:
  # Primary key field
  primary_key:
    name: "id"
    type: "INT64"
    auto_id: true

  # Vector field
  vector_field:
    name: "vector"
    type: "FLOAT_VECTOR"

  # Metadata fields for filtering
  metadata_fields:
    - name: "category"
      type: "VARCHAR"
      max_length: 64
    - name: "price"
      type: "FLOAT"
    - name: "timestamp"
      type: "INT64"
    - name: "active"
      type: "BOOL"

# -----------------------------------------------------------------------------
# Batch Settings
# -----------------------------------------------------------------------------
batch:
  insert_batch_size: 10000
  search_batch_size: 100
  parallel_requests: 4

# -----------------------------------------------------------------------------
# Resource Management
# -----------------------------------------------------------------------------
resources:
  # Memory pool
  memory_pool:
    enabled: true
    init_size_mb: 1024
    max_size_mb: 8192

  # Cache
  cache:
    enabled: true
    cache_size_mb: 4096
