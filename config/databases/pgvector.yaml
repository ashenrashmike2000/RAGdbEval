# =============================================================================
# pgvector Configuration
# =============================================================================
# Vector similarity search extension for PostgreSQL
# Documentation: https://github.com/pgvector/pgvector
# =============================================================================

database:
  name: "pgvector"
  display_name: "pgvector"
  version: "0.6.0"
  type: "extension"
  language: "C"
  license: "PostgreSQL"

# -----------------------------------------------------------------------------
# Connection Settings
# -----------------------------------------------------------------------------
connection:
  host: "127.0.0.1"
  port: 5433
  database: "benchmark"
  user: "postgres"
  password: "password"
  sslmode: "prefer"
  connect_timeout: 30

  # Connection pool settings
  pool:
    min_size: 1
    max_size: 10

  # Docker configuration
  docker:
    enabled: true
    image: "pgvector/pgvector:pg16"
    memory_limit: "16g"
    cpu_limit: 8
    port: 5432
    environment:
      POSTGRES_USER: "postgres"
      POSTGRES_PASSWORD: "postgres"
      POSTGRES_DB: "benchmark"

# -----------------------------------------------------------------------------
# Table Settings
# -----------------------------------------------------------------------------
table:
  name_prefix: "benchmark"
  schema: "public"

# -----------------------------------------------------------------------------
# Index Configurations to Test
# -----------------------------------------------------------------------------
index_configurations:
  # No index (exact search via sequential scan)
  # --- L2 Indexes ---
  - name: "HNSW_L2"
    type: "hnsw"
    params:
      distance: "l2"         # <--- Tag for filter
      m: 16
      ef_construction: 64
    search_params:
      ef_search: [ 40, 100 ]

  # --- Cosine Indexes ---
  - name: "HNSW_Cosine"
    type: "hnsw"
    params:
      distance: "cosine"     # <--- Tag for filter
      m: 16
      ef_construction: 64
    search_params:
      ef_search: [ 40, 100 ]

#  - name: "SeqScan"
#    type: "none"
#    description: "Sequential scan (exact search)"
#    params: {}
#    search_params:
#      set_enable_seqscan: true
#
#  # IVFFlat index
#  - name: "IVFFlat_100"
#    type: "ivfflat"
#    description: "IVFFlat with 100 lists"
#    params:
#      lists: 100
#    search_params:
#      probes: [1, 5, 10, 20, 50]
#
#  - name: "IVFFlat_500"
#    type: "ivfflat"
#    description: "IVFFlat with 500 lists"
#    params:
#      lists: 500
#    search_params:
#      probes: [1, 5, 10, 20, 50, 100]
#
#  - name: "IVFFlat_1000"
#    type: "ivfflat"
#    description: "IVFFlat with 1000 lists"
#    params:
#      lists: 1000
#    search_params:
#      probes: [1, 10, 20, 50, 100, 200]
#
#  - name: "IVFFlat_2000"
#    type: "ivfflat"
#    description: "IVFFlat with 2000 lists for larger datasets"
#    params:
#      lists: 2000
#    search_params:
#      probes: [1, 10, 20, 50, 100, 200, 400]
#
#  # HNSW index
#  - name: "HNSW_m16_ef64"
#    type: "hnsw"
#    description: "HNSW with m=16, ef_construction=64"
#    params:
#      m: 16
#      ef_construction: 64
#    search_params:
#      ef_search: [40, 80, 120, 200, 400]
#
#  - name: "HNSW_m32_ef128"
#    type: "hnsw"
#    description: "HNSW with m=32, ef_construction=128"
#    params:
#      m: 32
#      ef_construction: 128
#    search_params:
#      ef_search: [64, 128, 256, 400]
#
#  - name: "HNSW_m48_ef200"
#    type: "hnsw"
#    description: "HNSW with higher accuracy settings"
#    params:
#      m: 48
#      ef_construction: 200
#    search_params:
#      ef_search: [100, 200, 300, 500]
#
#  - name: "HNSW_m64_ef256"
#    type: "hnsw"
#    description: "HNSW with maximum accuracy"
#    params:
#      m: 64
#      ef_construction: 256
#    search_params:
#      ef_search: [128, 256, 512, 800]

# -----------------------------------------------------------------------------
# Distance Metrics Support
# -----------------------------------------------------------------------------
distance_metrics:
  l2:
    supported: true
    operator: "<->"
    ops_class: "vector_l2_ops"
    index_suffix: "_l2"
  cosine:
    supported: true
    operator: "<=>"
    ops_class: "vector_cosine_ops"
    index_suffix: "_cosine"
  ip:
    supported: true
    operator: "<#>"
    ops_class: "vector_ip_ops"
    index_suffix: "_ip"

# -----------------------------------------------------------------------------
# Schema Configuration
# -----------------------------------------------------------------------------
schema:
  columns:
    - name: "id"
      type: "BIGSERIAL PRIMARY KEY"
    - name: "vector"
      type: "vector"  # dimension will be added dynamically
    - name: "category"
      type: "VARCHAR(64)"
    - name: "price"
      type: "REAL"
    - name: "timestamp"
      type: "BIGINT"
    - name: "active"
      type: "BOOLEAN"

  # Indexes on metadata columns
  metadata_indexes:
    - columns: ["category"]
      type: "btree"
    - columns: ["price"]
      type: "btree"
    - columns: ["timestamp"]
      type: "btree"
    - columns: ["active"]
      type: "btree"

# -----------------------------------------------------------------------------
# PostgreSQL Settings
# -----------------------------------------------------------------------------
postgres_settings:
  # Memory settings
  shared_buffers: "4GB"
  effective_cache_size: "12GB"
  work_mem: "512MB"
  maintenance_work_mem: "2GB"

  # Parallelism
  max_parallel_workers_per_gather: 4
  max_parallel_workers: 8
  max_parallel_maintenance_workers: 4

  # IVFFlat specific
  ivfflat.probes: 10

  # HNSW specific
  hnsw.ef_search: 100

# -----------------------------------------------------------------------------
# Batch Settings
# -----------------------------------------------------------------------------
batch:
  insert_batch_size: 5000
  search_batch_size: 100

  # Use COPY for bulk inserts
  use_copy: true

# -----------------------------------------------------------------------------
# Index Build Settings
# -----------------------------------------------------------------------------
build:
  # Parallel index build
  parallel: true
  maintenance_work_mem: "4GB"

  # Progress reporting
  show_progress: true
